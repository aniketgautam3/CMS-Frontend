<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
crossorigin="anonymous"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<ul class="nav nav-pills justify-content-center nav-fill" role="tablist">
    <li class="nav-item" >
      <a class="nav-link active" id="todayOrderTab" href="#">Upcoming Orders</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="pastFutureOrdersTab" href="#">Past Orders</a>
    </li>
</ul>
<div class="d-flex justify-content-end mt-2 me-4">
    <input type="date" id="date-picker" class="col-3 d-none" />
</div>
<div id="orders-list" class="container-fluid mt-3"></div>

<script>
    // Default values
    let selectedDate = new Date(); // Today's date
    const today = new Date();
    document.getElementById('date-picker').value = (new Date(today - (24*60*60*1000))).toISOString().substr(0, 10); // set the default date of date picker to yesterday

    const orders = [
        {"id":1,"status":"Pending","orderType":"Lunch","timeStamp":"2023-03-10T15:25:36.000+00:00","feedBack":null,"items":[]},
        {"id":2,"status":"Pending","orderType":"Lunch","timeStamp":"2023-02-27T15:25:36.000+00:00","feedBack":null,"items":[]},
        {"id":3,"status":"Pending","orderType":"Lunch","timeStamp":"2023-02-26T15:25:36.000+00:00","feedBack":null,"items":[]},
        {"id":4,"status":"Pending","orderType":"Lunch","timeStamp":"2023-02-26T15:25:36.000+00:00","feedBack":null,"items":[]}
    ];
    
    const displayOrdersList = () => {
        const ordersListElem = document.getElementById('orders-list');
        const filteredOrders = orders.filter(order => {
            const orderDate = new Date(order.timeStamp);
            return orderDate.getDate() === selectedDate.getDate() &&
                orderDate.getMonth() === selectedDate.getMonth() &&
                orderDate.getFullYear() === selectedDate.getFullYear();
        });
        // List the orders
        ordersListElem.innerHTML = '';
        filteredOrders.forEach((order) => {
            const orderElement = document.createElement("div");
            const orderDate = new Date(order.timeStamp);
            orderElement.innerHTML = `
                <div class="card mt-2">
                <div class="card-header">
                    <span class="card-subtitle text-muted float-start">Status: <span class="${order.status != 'Delivered' ? 'text-danger' : 'text-success'}">${order.status}</span></span>
                    <span class="card-subtitle text-muted float-end">Order ID: ${order.id} at ${order.timeStamp}</span>
                </div>
                <div class="card-body">
                    <b>Order Type:</b> ${order.orderType} <br/>
                    <b>Items:</b> <br/> 
                    ${order.items.length === 0 ? "None" : order.items.join(", ")} <br/>
                    
                </div>
                ${
                    // Display Mark as delivered button only if the order is pending and is for today
                    order.status === 'Pending' && orderDate.getDate() === today.getDate() && orderDate.getMonth() === today.getMonth() && orderDate.getFullYear() === today.getFullYear() ?
                    `
                    <div class="card-footer">
                        <button class="btn btn-success float-end">Mark as Delivered</button>
                    </div>
                    ` : ''
                }
                </div>
            `;
            ordersListElem.appendChild(orderElement);
        });
    }

    // Event Handlers
    document.getElementById('date-picker').addEventListener('change', (e) => {
        if (!document.getElementById('pastFutureOrdersTab').classList.contains('active'))
            return;
        selectedDate = new Date(e.target.value);
        displayOrdersList();
    });
    document.getElementById('todayOrderTab').addEventListener('click', (e) => {
        selectedDate = today;
        document.getElementById('todayOrderTab').classList.add('active');
        document.getElementById('pastFutureOrdersTab').classList.remove('active');
        document.getElementById('date-picker').classList.add('d-none');
        displayOrdersList();
    });
    document.getElementById('pastFutureOrdersTab').addEventListener('click', (e) => {
        selectedDate = new Date(document.getElementById('date-picker').value);
        document.getElementById('todayOrderTab').classList.remove('active');
        document.getElementById('pastFutureOrdersTab').classList.add('active');
        document.getElementById('date-picker').classList.remove('d-none');
        displayOrdersList();
    });
    // TODO: add this inside event of getallorders api fetched
    displayOrdersList();
</script>